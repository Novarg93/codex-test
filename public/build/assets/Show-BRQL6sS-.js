import{l as q,p as f,g as s,o as t,a as m,w as k,b as a,t as o,F as i,q as x,i as d,f as u,d as b,n as A,L as $,e as S,B,s as F}from"./app-KhPXK_eo.js";import{a as w,_ as O}from"./DefaultLayout.vue_vue_type_script_setup_true_lang-BTbjbBgZ.js";import{_ as V}from"./OrderStatusBadge.vue_vue_type_script_setup_true_lang-DDya4v_C.js";import{_ as K}from"./Input-C3EQsbHI.js";import{_ as L}from"./SeoHead.vue_vue_type_script_setup_true_lang-Dh5GiDDG.js";import"./index-FV2GQg2N.js";const T={class:"w-[90%] 2xl:w-[75%] mx-auto py-8"},U={class:"flex items-center gap-3 mb-6"},z={class:"text-3xl font-semibold"},Z={class:"grid lg:grid-cols-3 gap-6"},D={class:"lg:col-span-2 space-y-3"},G={class:"flex items-center gap-4"},I=["src","alt"],M={class:"font-medium"},Q={key:0,class:"text-sm text-muted-foreground"},H={class:"list-disc pl-5 space-y-0.5"},J={key:0,class:"text-[10px] mr-2 px-1.5 py-0.5 rounded bg-amber-100 text-amber-900 border border-amber-200"},W={class:"font-medium"},X={key:1,class:"ml-1"},Y={key:1,class:"text-sm text-muted-foreground"},ee={class:"mt-2"},se=["href"],te={key:1,class:"text-sm text-muted-foreground"},re={key:2,class:"text-sm text-green-700"},ae={key:3,class:"text-sm text-muted-foreground"},ne={class:"font-semibold"},oe={class:"lg:col-span-1 space-y-4"},le={class:"border border-border rounded-lg p-4"},de={class:"flex items-center justify-between"},ie={class:"text-sm text-muted-foreground"},ue={class:"mt-2 text-lg font-semibold"},ce={key:0,class:"mt-4 space-y-2"},me={key:0,class:"text-xs text-amber-600"},_e={class:"flex items-center justify-between mb-2"},ve={class:"text-sm"},pe={key:0},fe={class:"font-medium"},ye={key:1,class:"text-amber-700"},ge={class:"flex items-center gap-2"},ke={key:0,class:"mt-1 text-xs text-red-600"},$e=q({__name:"Show",props:{seo:{},order:{}},setup(j){const _=j;function y(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:_.order.currency}).format(e/100)}function E(e){return e.calc_mode==="percent"?(e.value_percent??0)!==0:(e.value_cents??0)!==0}function P(e){B.post(route("orders.pay",e))}const v=f(!1),g=f(_.order.nickname??""),p=f(!1),h=f(!1),c=f(null);function R(){c.value=null,g.value=_.order.nickname??"",v.value=!0}function N(){v.value=!1,c.value=null}async function C(){const e=g.value.trim();if(!e){c.value="Required";return}if(!/^[A-Za-z0-9_]{2,30}$/.test(e)){c.value='Only letters, digits and "_", 2–30 chars.';return}if(!p.value){p.value=!0,c.value=null;try{const{data:r}=await F.post(route("orders.nickname",_.order.id),{nickname:e});_.order.nickname=r.nickname,_.order.needs_nickname=!1,v.value=!1,h.value=!0,setTimeout(()=>h.value=!1,2e3)}catch(r){const n=r?.response?.data?.message||"Failed to save";c.value=String(n)}finally{p.value=!1}}}return(e,r)=>(t(),s(i,null,[m(L,{seo:e.seo},null,8,["seo"]),m(O,null,{default:k(()=>[a("section",T,[a("div",U,[a("h1",z,"Order #"+o(e.order.id),1),m(V,{status:e.order.status},null,8,["status"])]),a("div",Z,[a("div",D,[(t(!0),s(i,null,x(e.order.items,n=>(t(),s("div",{key:n.id,class:"border border-border rounded-lg p-4 flex justify-between"},[a("div",G,[n.image_url?(t(),s("img",{key:0,class:"w-16 h-16 object-cover rounded",src:n.image_url,alt:n.product_name},null,8,I)):d("",!0),a("div",null,[a("div",M,o(n.product_name),1),n.options?.length?(t(),s("div",Q,[a("ul",H,[(t(!0),s(i,null,x(n.options,l=>(t(),s("li",{key:l.id},[l.is_ga?(t(),s("span",J,"GA")):d("",!0),a("span",W,o(l.title),1),E(l)?(t(),s("span",X,[r[2]||(r[2]=u(" ( ",-1)),l.calc_mode==="percent"?(t(),s(i,{key:0},[u("+"+o(l.value_percent??0)+"% "+o(l.scope),1)],64)):(t(),s(i,{key:1},[u(o((l.value_cents??0)>=0?"+":"")+o(y(l.value_cents??0))+" "+o(l.scope),1)],64)),r[3]||(r[3]=u(" ) ",-1))])):d("",!0)]))),128))])])):d("",!0),n.ranges?.length?(t(),s("div",Y,[(t(!0),s(i,null,x(n.ranges,l=>(t(),s("div",{key:l.label},o(l.title)+": "+o(l.label),1))),128))])):d("",!0),n.has_qty_slider?(t(),s(i,{key:2},[u(" Qty: "+o(n.qty)+" · "+o(y(n.unit_price_cents))+"/each ",1)],64)):d("",!0),a("div",ee,[e.order.status==="completed"&&n.review_state==="none"&&n.leave_review_url?(t(),s("a",{key:0,href:n.leave_review_url,class:"text-sm underline text-primary hover:opacity-80"}," Leave review ",8,se)):n.review_state==="pending"?(t(),s("span",te," Review submitted (pending) ")):n.review_state==="approved"?(t(),s("span",re," Review published ")):n.review_state==="rejected"?(t(),s("span",ae," Review submitted ")):d("",!0)])])]),a("div",ne,o(y(n.line_total_cents)),1)]))),128))]),a("div",oe,[a("div",le,[a("div",de,[a("div",ie,o(e.order.placed_at||"—"),1),m(V,{status:e.order.status},null,8,["status"])]),a("div",ue,"Total: "+o(y(e.order.total_cents)),1),e.order.status==="pending"?(t(),s("div",ce,[m(b(w),{class:"w-full",onClick:r[0]||(r[0]=n=>P(e.order.id))},{default:k(()=>[...r[4]||(r[4]=[u("Retry Payment",-1)])]),_:1}),e.$page.props.auth?.user&&!e.$page.props.auth.user.email_verified_at?(t(),s("p",me," Please verify your email to complete the payment. ")):d("",!0)])):d("",!0)]),a("div",{class:A(["border border-border rounded-lg p-4",h.value?"bg-green-700/10 border-green-700":""])},[a("div",_e,[r[5]||(r[5]=a("div",{class:"font-semibold"},"Character nickname",-1)),v.value?d("",!0):(t(),s("button",{key:0,class:"text-xs px-2 py-1 rounded border hover:bg-muted",onClick:R},o(e.order.nickname?"Edit":"Add"),1))]),v.value?(t(),s(i,{key:1},[a("div",ge,[m(b(K),{modelValue:g.value,"onUpdate:modelValue":r[1]||(r[1]=n=>g.value=n),class:"h-9 px-2 rounded border w-56",placeholder:"Nickname (A–Z, 0–9, _)",onKeydown:[$(S(C,["prevent"]),["enter"]),$(S(N,["prevent"]),["esc"])],autocomplete:"off"},null,8,["modelValue","onKeydown"]),m(b(w),{variant:"default",disabled:p.value,onClick:C},{default:k(()=>[u(o(p.value?"Saving…":"Save"),1)]),_:1},8,["disabled"]),m(b(w),{variant:"secondary",onClick:N},{default:k(()=>[...r[9]||(r[9]=[u("Cancel",-1)])]),_:1})]),c.value?(t(),s("div",ke,o(c.value),1)):d("",!0),r[10]||(r[10]=a("div",{class:"mt-1 text-xs text-muted-foreground"},"Only letters, digits and “_”, 2–30 chars.",-1))],64)):(t(),s(i,{key:0},[a("div",ve,[e.order.nickname?(t(),s("span",pe,[r[6]||(r[6]=a("span",{class:"text-muted-foreground"},"Current:",-1)),r[7]||(r[7]=u()),a("span",fe,o(e.order.nickname),1)])):(t(),s("span",ye,"Not set"))]),r[8]||(r[8]=a("p",{class:"text-xs text-muted-foreground mt-1"},"Used for in-game delivery.",-1))],64))],2)])])])]),_:1})],64))}});export{$e as default};
