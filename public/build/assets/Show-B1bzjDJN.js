const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/SelectorDropdown-vWpGAU2_.js","assets/app-BkV54G4n.js","assets/pusher-Ci2UwTJi.js","assets/app-HSVyR0zT.css"])))=>i.map(i=>d[i]);
import{l as X,C as Q,D as z,j as k,g as v,o as m,b as s,f as D,i as U,t as $,F as C,q as R,k as Z,d as G,y as re,E as Ue,G as de,p as j,H as he,I as Te,J as Fe,_ as De,x as O,n as oe,A as Pe,a as ce,w as Re,c as ae,K as Ee,e as Le,s as _e}from"./app-BkV54G4n.js";import{_ as Ve,u as Be}from"./DefaultLayout.vue_vue_type_script_setup_true_lang-D8s7rDB9.js";import{_ as je}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-Dasmot2v.js";import{_ as Oe}from"./SeoHead.vue_vue_type_script_setup_true_lang-CQLBdbsh.js";import{S as ze}from"./star-C6MCPq4p.js";import"./pusher-Ci2UwTJi.js";import"./BreadcrumbSeparator-1TgcSqpK.js";const We={class:"space-y-2"},He={class:"font-medium mb-2"},Je={key:0,class:"text-xs text-muted-foreground"},Ke=["name","value","checked","onChange"],Qe=["checked","onChange"],Xe={class:"ml-auto text-sm text-muted-foreground"},Ne=X({__name:"SelectorGroup",props:Q({group:{}},{selected:{},selectedModifiers:{}}),emits:["update:selected"],setup(i){const d=i,t=z(i,"selected"),g=k(()=>d.group.selection_mode==="single"),N=k(()=>d.group.pricing_mode==="percent");function x(u){return((u??0)/100).toLocaleString("en-US",{style:"currency",currency:"USD"})}function w(u){return Array.isArray(t.value)?t.value.includes(u.id):t.value===u.id}function _(u){t.value=u}function h(u,f){const o=Array.isArray(t.value)?[...t.value]:[];if(f)o.includes(u)||o.push(u);else{const l=o.indexOf(u);l>=0&&o.splice(l,1)}t.value=o}return(u,f)=>(m(),v("div",We,[s("div",He,[D($(u.group.title)+" ",1),u.group.is_required?(m(),v("span",Je,"(required)")):U("",!0)]),(m(!0),v(C,null,R(u.group.values,o=>(m(),v("label",{key:o.id,class:"flex items-center gap-2 cursor-pointer"},[g.value?(m(),v("input",{key:0,type:"radio",name:"g-"+u.group.id,value:o.id,checked:w(o),onChange:l=>_(o.id)},null,40,Ke)):(m(),v("input",{key:1,type:"checkbox",checked:w(o),onChange:l=>h(o.id,l.target.checked)},null,40,Qe)),s("span",null,$(o.title),1),s("span",Xe,[N.value?(m(),v(C,{key:0},[D(" +"+$(o.delta_percent??0)+"% ",1)],64)):(m(),v(C,{key:1},[D($((o.delta_cents??0)>=0?"+":"")+$(x(o.delta_cents??0)),1)],64))])]))),128))]))}}),Ye={class:"space-y-3"},Ze={class:"font-medium"},et={key:0,class:"text-xs text-muted-foreground"},tt={class:"text-sm text-muted-foreground"},st=["min","max","step"],nt={class:"mt-2 flex items-center gap-2"},at=["min","max","step"],lt=X({__name:"QtySlider",props:Q({group:{}},{selected:{},selectedModifiers:{}}),emits:["update:selected"],setup(i){const d=i,t=z(i,"selected"),g=Number(d.group.qty_min??1),N=Number(d.group.qty_max??1),x=Number(d.group.qty_step??1);function w(){t.value=Math.max(g,Number(t.value||g)-x)}function _(){t.value=Math.min(N,Number(t.value||g)+x)}return(h,u)=>(m(),v("div",Ye,[s("div",Ze,[D($(h.group.title)+" ",1),h.group.is_required?(m(),v("span",et,"(required)")):U("",!0)]),s("div",tt,$(t.value)+" (min: "+$(G(g))+", max: "+$(G(N))+", step: "+$(G(x))+") ",1),Z(s("input",{type:"range",class:"w-full",min:G(g),max:G(N),step:G(x),"onUpdate:modelValue":u[0]||(u[0]=f=>t.value=f)},null,8,st),[[re,t.value,void 0,{number:!0}]]),s("div",nt,[Z(s("input",{type:"number",class:"w-24 bg-background border rounded px-2 py-1",min:G(g),max:G(N),step:G(x),"onUpdate:modelValue":u[1]||(u[1]=f=>t.value=f)},null,8,at),[[re,t.value,void 0,{number:!0}]]),s("button",{class:"px-2 py-1 border rounded",onClick:w},"-"),s("button",{class:"px-2 py-1 border rounded",onClick:_},"+")])]))}}),ut={key:0,class:"space-y-3"},rt={class:"flex items-center justify-between"},ot={class:"font-medium"},it={class:"text-sm text-muted-foreground"},dt={class:"relative h-2 rounded bg-muted overflow-hidden"},ct={class:"relative"},mt=["min","max","step","value"],pt=["min","max","step","value"],ft={class:"mt-2 flex items-center gap-2"},vt={class:"flex items-center gap-2"},_t=["min","max","step","value"],yt={class:"flex items-center gap-2"},gt=["min","max","step","value"],bt=X({__name:"DoubleRange",props:Q({group:{}},{selected:{},selectedModifiers:{}}),emits:["update:selected"],setup(i){const d=i,t=z(i,"selected");Ue(()=>{if(!t.value){const l=Number(d.group.range_default_min??d.group.slider_min),e=Number(d.group.range_default_max??d.group.slider_max);t.value={min:Math.min(l,e),max:Math.max(l,e)}}});const g=Number(d.group.slider_min),N=Number(d.group.slider_max),x=Number(d.group.slider_step||1);function w(l,e,c){return Math.min(c,Math.max(e,l))}function _(l,e,c){return l-(l-e)%c}function h(l){const e=N-g;return e<=0?0:(l-g)/e*100}function u(l){const e=_(w(l,g,N),g,x),c=_(w(t.value?.max??N,g,N),g,x);t.value={min:Math.min(e,c),max:Math.max(e,c)}}function f(l){const e=_(w(t.value?.min??g,g,N),g,x),c=_(w(l,g,N),g,x);t.value={min:Math.min(e,c),max:Math.max(e,c)}}const o=k(()=>d.group.pricing_mode==="tiered"&&(d.group.tiers?.length??0)>0);return(l,e)=>t.value?(m(),v("div",ut,[s("div",rt,[s("div",ot,$(l.group.title),1),s("div",it,$(t.value.min)+"–"+$(t.value.max)+" (min: "+$(G(g))+", max: "+$(G(N))+", step: "+$(G(x))+") ",1)]),s("div",dt,[s("div",{class:"absolute top-0 h-2 bg-primary/50",style:de({left:h(t.value.min)+"%",width:h(t.value.max)-h(t.value.min)+"%"})},null,4),o.value?(m(),v(C,{key:0},[(m(!0),v(C,null,R(l.group.tiers,(c,A)=>(m(),v("div",{key:"from-"+A,class:"absolute top-[-6px] bottom-[-6px] w-px bg-foreground/40",style:de({left:h(c.from)+"%"})},null,4))),128)),(m(!0),v(C,null,R(l.group.tiers,(c,A)=>(m(),v("div",{key:"to-"+A,class:"absolute top-[-6px] bottom-[-6px] w-px bg-foreground/40",style:de({left:h(c.to)+"%"})},null,4))),128))],64)):U("",!0)]),s("div",ct,[s("input",{type:"range",class:"w-full appearance-none bg-transparent absolute top-0 -translate-y-6",min:G(g),max:G(N),step:G(x),value:t.value.min,onInput:e[0]||(e[0]=c=>u(Number(c.target.value))),style:{"z-index":"20"}},null,40,mt),s("input",{type:"range",class:"w-full appearance-none bg-transparent absolute top-0 -translate-y-8",min:G(g),max:G(N),step:G(x),value:t.value.max,onInput:e[1]||(e[1]=c=>f(Number(c.target.value))),style:{"z-index":"20"}},null,40,pt)]),s("div",ft,[s("div",vt,[e[4]||(e[4]=s("label",{class:"text-sm text-muted-foreground"},"From",-1)),s("input",{type:"number",class:"w-24 bg-background border rounded px-2 py-1",min:G(g),max:G(N),step:G(x),value:t.value.min,onInput:e[2]||(e[2]=c=>u(Number(c.target.value)))},null,40,_t)]),s("div",yt,[e[5]||(e[5]=s("label",{class:"text-sm text-muted-foreground"},"To",-1)),s("input",{type:"number",class:"w-24 bg-background border rounded px-2 py-1",min:G(g),max:G(N),step:G(x),value:t.value.max,onInput:e[3]||(e[3]=c=>f(Number(c.target.value)))},null,40,gt)])])])):U("",!0)}}),xt={class:"space-y-3"},ht={class:"font-medium"},Nt={class:"flex gap-2 items-center"},kt=["value"],$t=["disabled"],wt={key:0,class:"space-y-3"},At={class:"flex justify-between"},St={class:"flex items-center gap-4"},Mt={class:"flex items-center font-semibold"},Gt=["onClick"],qt={class:"flex flex-col gap-2"},Ct=["onUpdate:modelValue","min","max","step"],It=["onUpdate:modelValue","min","max","step"],Ut={class:"text-right font-bold"},Tt=X({__name:"BundleBuilder",props:Q({group:{}},{selected:{default:[]},selectedModifiers:{}}),emits:["update:selected"],setup(i){const d=i,t=z(i,"selected"),g=k(()=>new Set(t.value.map(o=>o.product_id))),N=k(()=>d.group.items.filter(o=>!g.value.has(o.product_id))),x=j(null);function w(){const o=x.value?Number(x.value):null;if(!o||g.value.has(o))return;const l=d.group.items.find(e=>e.product_id===o);l&&(t.value=[...t.value,{product_id:o,qty:l.qty.default??l.qty.min}],x.value=null)}function _(o){t.value=t.value.filter(l=>l.product_id!==o)}function h(o){const l=d.group.items.find(e=>e.product_id===o);return{min:l?.qty.min??1,max:l?.qty.max??9999,step:l?.qty.step??1}}const u=k(()=>t.value.reduce((o,l)=>{const e=d.group.items.find(c=>c.product_id===l.product_id);return o+(e?e.price_cents*(l.qty||0):0)},0));function f(o){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format((o||0)/100)}return(o,l)=>(m(),v("div",xt,[s("div",ht,$(o.group.title),1),s("div",Nt,[Z(s("select",{"onUpdate:modelValue":l[0]||(l[0]=e=>x.value=e),placeholder:"Select product",class:"border text-black rounded placeholder:text-black px-2 w-full py-1"},[l[1]||(l[1]=s("option",{value:"",selected:"",disabled:""},"Select product…",-1)),(m(!0),v(C,null,R(N.value,e=>(m(),v("option",{key:e.product_id,value:String(e.product_id)},$(e.name)+" — "+$(f(e.price_cents))+"/unit ",9,kt))),128))],512),[[he,x.value]]),s("button",{class:"px-3 py-1 border rounded",onClick:w,disabled:!x.value},"Add",8,$t)]),t.value.length?(m(),v("div",wt,[(m(!0),v(C,null,R(t.value,e=>(m(),v("div",{key:e.product_id,class:"flex flex-col gap-3 border rounded p-2"},[s("div",At,[s("div",null,$(d.group.items.find(c=>c.product_id===e.product_id)?.name),1),s("div",St,[s("div",Mt,$(((d.group.items.find(c=>c.product_id===e.product_id)?.price_cents||0)*(e.qty||0)/100).toFixed(2))+" $ ",1),s("button",{class:"text-sm px-2 py-1 border rounded",onClick:c=>_(e.product_id)},"Remove",8,Gt)])]),s("div",qt,[Z(s("input",{type:"number",class:"w-full text-black border rounded px-2 py-1","onUpdate:modelValue":c=>e.qty=c,min:h(e.product_id).min,max:h(e.product_id).max,step:h(e.product_id).step},null,8,Ct),[[re,e.qty,void 0,{number:!0}]]),Z(s("input",{type:"range",class:"w-full","onUpdate:modelValue":c=>e.qty=c,min:h(e.product_id).min,max:h(e.product_id).max,step:h(e.product_id).step},null,8,It),[[re,e.qty,void 0,{number:!0}]])])]))),128)),s("div",Ut,"Total: "+$(f(u.value)),1)])):U("",!0)]))}}),Ft=Te(()=>De(()=>import("./SelectorDropdown-vWpGAU2_.js"),__vite__mapDeps([0,1,2,3]))),Dt=Fe({selector:Ne,quantity_slider:lt,double_range_slider:bt,bundle:Tt});function ye(i,d){return i==="selector"?d?.ui_variant==="dropdown"&&d?.selection_mode==="single"?Ft:Ne:Dt[i]??null}function Pt(i){const d=j({}),t=_=>typeof _=="number"&&Number.isFinite(_),g=_=>Array.isArray(_)&&_.every(h=>typeof h=="number"),N=_=>!!_&&typeof _=="object"&&"min"in _&&"max"in _;(i.option_groups??[]).forEach(_=>{if(_.type==="selector")if(_.selection_mode==="single"){const h=_.values.find(u=>u.is_default)??_.values[0];d.value[_.id]=h?h.id:null}else d.value[_.id]=[];else if(_.type==="quantity_slider"){const h=Number(_.qty_min??1),u=Number(_.qty_step??1),f=Number(_.qty_default??h),o=Math.max(h,Math.min(Number(_.qty_max??f),f));d.value[_.id]=o-(o-h)%u}else if(_.type==="double_range_slider"){const h=Number(_.range_default_min??_.slider_min),u=Number(_.range_default_max??_.slider_max);d.value[_.id]={min:Math.min(h,u),max:Math.max(h,u)}}});const x=k(()=>(i.option_groups??[]).find(_=>_.type==="quantity_slider")??null);function w(){const _=[],h=[];let u=1;return(i.option_groups??[]).forEach(f=>{const o=d.value[f.id];f.type==="selector"?f.selection_mode==="single"?t(o)&&_.push(o):g(o)&&_.push(...o):f.type==="quantity_slider"?t(o)&&(u=o):f.type==="double_range_slider"&&N(o)&&h.push({option_group_id:f.id,selected_min:o.min,selected_max:o.max})}),{product_id:i.id,option_value_ids:_,qty:u,range_options:h}}return{selectionByGroup:d,qtyGroup:x,buildAddToCartPayload:w}}const Rt=i=>!!i&&typeof i=="object"&&"min"in i&&"max"in i;function le(i){return i?.multiply_by_qty===null||i?.multiply_by_qty===void 0?!0:i.multiply_by_qty===!0||i.multiply_by_qty===1||i.multiply_by_qty==="1"}function ge(i){return i?.pricing_mode==="percent"||i?.type==="radio_percent"||i?.type==="checkbox_percent"}function ue(i){if(Array.isArray(i))return i.map(Number).filter(Number.isFinite);const d=Number(i);return Number.isFinite(d)?[d]:[]}function be(i,d,t){return Math.min(t,Math.max(d,i))}function xe(i,d,t){return i-(i-d)%t}function ke(i,d){const t=i.slider_min,g=i.slider_max,N=Math.max(1,i.slider_step||1),x=xe(be(d.min,t,g),t,N),w=xe(be(d.max,t,g),t,N),_=Math.min(x,w),h=Math.max(x,w);return{min:_,max:h}}function Et(i,d){const{min:t,max:g}=ke(i,d),N=Math.max(1,i.slider_step||1),x=Math.max(0,Math.floor((g-t)/N)),w=Number(i.unit_price_cents??0);return x*w}function Lt(i,d){const{min:t,max:g}=ke(i,d),N=Math.max(0,g-t),x=(i.tiers??[]).slice().sort((l,e)=>l.from-e.from);let w=0,_=0,h=0;for(const l of x){const e=Math.max(l.from,t),c=Math.min(l.to,g);if(c<=e)continue;let A=c-e,S=Number(l.unit_price_cents??0);l.multiplier&&(S=Math.round(S*Number(l.multiplier))),l.min_block&&l.min_block>1&&(A=Math.ceil(A/Number(l.min_block))*Number(l.min_block));let E=S*A;l.cap_cents!=null&&(E=Math.min(E,Number(l.cap_cents))),w+=E,_=Math.max(_,S),h+=S*(c-e)}const u=i.tier_combine_strategy??"sum_piecewise",f=u==="highest_tier_only"?_*N:u==="weighted_average"?Math.round((N>0?h/N:0)*N):w;return Number(i.base_fee_cents??0)+f}function Vt(i,d){const t=k(()=>{let u=0;return(i.option_groups??[]).forEach(f=>{if(f?.type!=="selector"||f?.pricing_mode!=="absolute"||!le(f))return;ue(d.value[f.id]).forEach(l=>{const e=(f.values??[]).find(c=>c.id===l);e&&(u+=Number(e.delta_cents??0))})}),u}),g=k(()=>{let u=0;return(i.option_groups??[]).forEach(f=>{if(f?.type!=="selector"||f?.pricing_mode!=="absolute"||le(f))return;ue(d.value[f.id]).forEach(l=>{const e=(f.values??[]).find(c=>c.id===l);e&&(u+=Number(e.delta_cents??0))})}),u}),N=k(()=>{let u=0;return(i.option_groups??[]).forEach(f=>{if(f?.type!=="double_range_slider")return;const o=d.value[f.id];Rt(o)&&(u+=f.pricing_mode==="tiered"?Lt(f,o):Et(f,o))}),u}),x=k(()=>{let u=0;return(i.option_groups??[]).forEach(f=>{if(!ge(f)||!le(f))return;ue(d.value[f.id]).forEach(l=>{const e=(f.values??[]).find(c=>c.id===l);e&&(u+=Number(e.delta_percent??e.value_percent??0))})}),u}),w=k(()=>{let u=0;return(i.option_groups??[]).forEach(f=>{if(!ge(f)||le(f))return;ue(d.value[f.id]).forEach(l=>{const e=(f.values??[]).find(c=>c.id===l);e&&(u+=Number(e.delta_percent??e.value_percent??0))})}),u}),_=k(()=>{const u=Number(i.price_cents||0)+t.value+N.value;return Math.round(u*(1+x.value/100))}),h=k(()=>{const u=(i.option_groups??[]).find(e=>e.type==="quantity_slider"),f=u?d.value[u.id]:void 0,o=typeof f=="number"&&Number.isFinite(f)?f:1,l=_.value*o+g.value;return Math.round(l*(1+w.value/100))});return{unitCents:_,totalCents:h}}const Bt={class:"space-y-4"},jt={class:"font-medium mb-1"},Ot={key:0,class:"text-xs text-muted-foreground"},zt=["value"],Wt={key:0,value:""},Ht=["value"],Jt={class:"font-medium mb-1"},Kt={key:0,class:"text-xs text-muted-foreground"},Qt=["value"],Xt={key:0,value:""},Yt=["value"],Zt={class:"font-medium mb-1 flex items-center justify-between"},es={class:"grid grid-cols-1 md:grid-cols-3 gap-2"},ts={class:"flex gap-2 items-center"},ss=["value"],ns=["value"],as={class:"flex items-center gap-1 text-xs"},ls=["checked","disabled"],us={class:"flex gap-2 items-center"},rs=["value"],os=["value"],is={class:"flex items-center gap-1 text-xs"},ds=["checked","disabled"],cs={class:"flex gap-2 items-center"},ms=["value"],ps=["value"],fs={class:"flex items-center gap-1 text-xs"},vs=["checked","disabled"],_s=X({__name:"RareItemBuilder",props:Q({classGroup:{},slotGroup:{},affixGroup:{},currency:{},gaLimit:{}},{classId:{default:null},classIdModifiers:{},slotId:{default:null},slotIdModifiers:{},affixIds:{default:[]},affixIdsModifiers:{},affixGaIds:{default:[]},affixGaIdsModifiers:{}}),emits:Q(["ga-valid"],["update:classId","update:slotId","update:affixIds","update:affixGaIds"]),setup(i,{emit:d}){const t=i,g=d,N=z(i,"classId"),x=z(i,"slotId"),w=z(i,"affixIds"),_=z(i,"affixGaIds"),h=k(()=>Number(o.value)+Number(l.value)+Number(e.value)),u=k(()=>Math.min(3,Math.max(0,Number(t.gaLimit??0)))),f=k(()=>h.value===u.value),o=j(!1),l=j(!1),e=j(!1);O([w],()=>{const[y,p,b]=w.value;y||(o.value=!1),p||(l.value=!1),b||(e.value=!1)},{deep:!0}),O([o,l,e,u],()=>{const y=[o,l,e],p=y.map((b,W)=>b.value?W:-1).filter(b=>b>=0);for(;p.length>u.value;){const b=p.pop();y[b].value=!1}}),O(u,y=>{const[p,b,W]=w.value;y===0?o.value=l.value=e.value=!1:y===3&&(o.value=!!p,l.value=!!b,e.value=!!W)}),O([w,o,l,e],()=>{const[y,p,b]=w.value,W=[y&&o.value?y:null,p&&l.value?p:null,b&&e.value?b:null].filter(Boolean);_.value=W}),O([h,u],()=>{g("ga-valid",f.value)},{immediate:!0});const c=y=>y.pricing_mode==="percent";function A(y,p){if(c(y))return`${p.title} (+${p.delta_percent??0}%)`;const b=Number(p.delta_cents??0)/100,W=b>=0?"+":"",ne=b.toLocaleString("en-US",{style:"currency",currency:t.currency??"USD"});return`${p.title} (${W}${ne})`}const S=(y,p)=>!p||!Array.isArray(y.allow_class_value_ids)||y.allow_class_value_ids.includes(p),E=(y,p)=>!p||!Array.isArray(y.allow_slot_value_ids)||y.allow_slot_value_ids.includes(p),H=k(()=>(t.slotGroup.values??[]).filter(y=>S(y,N.value)));function J(y){const p=new Set(w.value.filter(Boolean));return y&&p.delete(y),(t.affixGroup.values??[]).filter(b=>S(b,N.value)&&E(b,x.value)&&!p.has(b.id))}const V=j(null),L=j(null),B=j(null);function ee(){const y=w.value,p=Array.isArray(y)?y.slice(0,3):typeof y=="number"&&Number.isFinite(y)?[y]:[];V.value=p[0]??null,L.value=p[1]??null,B.value=p[2]??null}function se(){const y=[V.value,L.value,B.value].filter(p=>!!p);w.value=Array.from(new Set(y)).slice(0,3)}return ee(),O([V,L,B],se),O(w,ee),O(N,()=>{x.value&&!S({allow_class_value_ids:t.slotGroup.values.find(y=>y.id===x.value)?.allow_class_value_ids},N.value)&&(x.value=null);for(const y of[V,L,B]){const p=t.affixGroup.values.find(b=>b.id===y.value);if(!p){y.value=null;continue}S(p,N.value)||(y.value=null)}}),O(x,()=>{for(const y of[V,L,B]){const p=t.affixGroup.values.find(b=>b.id===y.value);if(!p){y.value=null;continue}E(p,x.value)||(y.value=null)}}),(y,p)=>(m(),v("div",Bt,[s("div",null,[s("div",jt,[p[8]||(p[8]=D(" Class ",-1)),y.classGroup.is_required?(m(),v("span",Ot,"(required)")):U("",!0)]),s("select",{class:"w-full border rounded-md px-3 py-2 bg-background",value:N.value??"",onChange:p[0]||(p[0]=b=>N.value=Number(b.target.value||NaN)||null)},[y.classGroup.is_required?U("",!0):(m(),v("option",Wt,"—")),(m(!0),v(C,null,R(y.classGroup.values,b=>(m(),v("option",{key:b.id,value:b.id},$(A(y.classGroup,b)),9,Ht))),128))],40,zt)]),s("div",null,[s("div",Jt,[p[9]||(p[9]=D(" Item slot ",-1)),y.slotGroup.is_required?(m(),v("span",Kt,"(required)")):U("",!0)]),s("select",{class:"w-full border rounded-md px-3 py-2 bg-background",value:x.value??"",onChange:p[1]||(p[1]=b=>x.value=Number(b.target.value||NaN)||null)},[y.slotGroup.is_required?U("",!0):(m(),v("option",Xt,"—")),(m(!0),v(C,null,R(H.value,b=>(m(),v("option",{key:b.id,value:b.id},$(A(y.slotGroup,b)),9,Yt))),128))],40,Qt)]),s("div",null,[s("div",Zt,[p[10]||(p[10]=s("span",null,[D(" Affixes "),s("span",{class:"text-xs text-muted-foreground"},"(up to 3)")],-1)),s("span",{class:oe(["text-xs",f.value?"text-muted-foreground":"text-red-600"])},[D(" GA: "+$(h.value)+"/"+$(u.value)+" chosen ",1),!f.value&&u.value>0?(m(),v(C,{key:0},[D(" — выберите ровно "+$(u.value),1)],64)):!f.value&&u.value===0?(m(),v(C,{key:1},[D(" — не выбирайте GA")],64)):U("",!0)],2)]),s("div",es,[s("div",ts,[s("select",{class:"w-full border rounded-md px-3 py-2 bg-background",value:V.value??"",onChange:p[2]||(p[2]=b=>V.value=Number(b.target.value||NaN)||null)},[p[11]||(p[11]=s("option",{value:""},"—",-1)),(m(!0),v(C,null,R(J(V.value),b=>(m(),v("option",{key:b.id,value:b.id},$(A(y.affixGroup,b)),9,ns))),128))],40,ss),s("label",as,[s("input",{type:"checkbox",checked:o.value,disabled:u.value===0||u.value===3||!V.value||h.value>=u.value&&!o.value,onChange:p[3]||(p[3]=b=>o.value=!o.value)},null,40,ls),p[12]||(p[12]=D(" Greater ",-1))])]),s("div",us,[s("select",{class:"w-full border rounded-md px-3 py-2 bg-background",value:L.value??"",onChange:p[4]||(p[4]=b=>L.value=Number(b.target.value||NaN)||null)},[p[13]||(p[13]=s("option",{value:""},"—",-1)),(m(!0),v(C,null,R(J(L.value),b=>(m(),v("option",{key:b.id,value:b.id},$(A(y.affixGroup,b)),9,os))),128))],40,rs),s("label",is,[s("input",{type:"checkbox",checked:l.value,disabled:u.value===0||u.value===3||!L.value||h.value>=u.value&&!l.value,onChange:p[5]||(p[5]=b=>l.value=!l.value)},null,40,ds),p[14]||(p[14]=D(" Greater ",-1))])]),s("div",cs,[s("select",{class:"w-full border rounded-md px-3 py-2 bg-background",value:B.value??"",onChange:p[6]||(p[6]=b=>B.value=Number(b.target.value||NaN)||null)},[p[15]||(p[15]=s("option",{value:""},"—",-1)),(m(!0),v(C,null,R(J(B.value),b=>(m(),v("option",{key:b.id,value:b.id},$(A(y.affixGroup,b)),9,ps))),128))],40,ms),s("label",fs,[s("input",{type:"checkbox",checked:e.value,disabled:u.value===0||u.value===3||!B.value||h.value>=u.value&&!e.value,onChange:p[7]||(p[7]=b=>e.value=!e.value)},null,40,vs),p[16]||(p[16]=D(" Greater ",-1))])])])])]))}}),ys={class:"space-y-4"},gs=["value"],bs={class:"font-medium mb-1 flex items-center justify-between"},xs={class:"space-y-1"},hs=["checked","disabled","onChange"],Ns=X({__name:"UniqueD4Builder",props:Q({gaGroup:{},statsGroup:{}},{gaSelected:{default:null},gaSelectedModifiers:{},statsSelected:{default:[]},statsSelectedModifiers:{}}),emits:["update:gaSelected","update:statsSelected"],setup(i){const d=i,t=z(i,"gaSelected"),g=z(i,"statsSelected");function N(e,c=0,A=4){const S=Number(e);return Math.min(A,Math.max(c,Number.isFinite(S)?S:0))}const x=k({get:()=>{const e=t.value;return Array.isArray(e)?e[0]??null:typeof e=="number"?e:null},set:e=>{t.value=e==null?null:Number(e)}}),w=k(()=>{const e=x.value,c=d.gaGroup.values?.find(E=>E.id===e);if(!c)return 0;const A=Number(c?.meta?.ga_count);if(Number.isFinite(A))return N(A,0,4);const S=String(c.title??"").match(/(\d)/);return N(S?Number(S[1]):0,0,4)});function _(e){if(d.gaGroup.pricing_mode==="percent")return`${e.title} ${e.delta_percent?`(+${e.delta_percent}%)`:""}`;const c=Number(e.delta_cents??0)/100,A=c.toLocaleString("en-US",{style:"currency",currency:"USD"}),S=c>=0?"+":"";return`${e.title} ${e.title==="Non GA"?"":`(${S}${A})`}`}function h(){const e=d.gaGroup.values?.find(A=>Number(A?.meta?.ga_count)===0),c=d.gaGroup.values?.find(A=>/(^|\s)non[-\s]?ga($|\s)|\b0\s*ga\b/i.test(String(A.title??"")));return(e??c??d.gaGroup.values?.[0])?.id??null}x.value==null&&(x.value=h()),O(w,e=>{e===0?g.value=[]:e===4?g.value=d.statsGroup.values?.map(c=>c.id)??[]:(g.value?.length??0)>e&&(g.value=g.value.slice(0,e))});const u=k(()=>g.value?.length??0),f=k(()=>u.value===w.value),o=k(()=>{const e=new Set,c=w.value,A=g.value?.length??0;if(c===0||c===4){for(const S of d.statsGroup.values??[])e.add(S.id);return e}if(A>=c)for(const S of d.statsGroup.values??[])g.value.includes(S.id)||e.add(S.id);return e});function l(e,c){const A=w.value,S=new Set(g.value);c?S.add(e):S.delete(e),g.value=Array.from(S).slice(0,A)}return(e,c)=>(m(),v("div",ys,[s("div",null,[c[1]||(c[1]=s("div",{class:"font-medium mb-1"},"Greater Affixes",-1)),Z(s("select",{class:"w-full border rounded-md px-3 py-2 bg-background","onUpdate:modelValue":c[0]||(c[0]=A=>x.value=A)},[(m(!0),v(C,null,R(e.gaGroup.values,A=>(m(),v("option",{key:A.id,value:A.id},$(_(A)),9,gs))),128))],512),[[he,x.value,void 0,{number:!0}]])]),s("div",null,[s("div",bs,[c[2]||(c[2]=s("span",null,"Item attributes",-1)),s("span",{class:oe(["text-xs",f.value?"text-muted-foreground":"text-red-600"])},[D($(u.value)+"/"+$(w.value)+" chosen ",1),!f.value&&w.value>0?(m(),v(C,{key:0},[D(" — choose exactly "+$(w.value),1)],64)):!f.value&&w.value===0?(m(),v(C,{key:1},[D(" — do not choose GA")],64)):U("",!0)],2)]),s("div",xs,[(m(!0),v(C,null,R(e.statsGroup.values,A=>(m(),v("label",{key:A.id,class:"flex items-center gap-2"},[s("input",{type:"checkbox",checked:g.value.includes(A.id),disabled:o.value.has(A.id),onChange:S=>l(A.id,S.target.checked)},null,40,hs),s("span",null,$(A.title),1)]))),128))])])]))}}),ks={class:"w-[90%] 2xl:w-[75%] mx-auto py-8 md:py-12 lg:py-16"},$s={key:0,class:"my-4 rounded-md border border-red-400 text-red-700 p-3"},ws={class:"list-disc pl-5"},As={class:"grid md:grid-cols-2 gap-6 my-6"},Ss=["src"],Ms={key:1,class:"aspect-video rounded-xl border grid place-items-center text-sm text-muted-foreground"},Gs={class:"text-3xl font-semibold"},qs={class:"mt-2 text-2xl font-bold"},Cs={class:"text-primary"},Is={key:2,class:"mt-4 space-y-6"},Us={key:0,class:"mt-1 text-sm text-red-600"},Ts={class:"mt-10 border-t border-border pt-8"},Fs={class:"flex items-center justify-between gap-4 mb-4"},Ds=["href"],Ps={key:0,class:"text-sm text-muted-foreground"},Rs={key:1,class:"space-y-3"},Es={class:"flex items-start justify-between gap-4"},Ls={class:"flex items-start gap-3"},Vs=["src","alt"],Bs={key:1,class:"w-10 h-10 rounded-full bg-muted"},js={class:"font-semibold"},Os={class:"flex items-center gap-2 text-xs text-muted-foreground"},zs={class:"flex items-center gap-0.5"},Ws={key:0},Hs={key:0,class:"text-xs whitespace-nowrap rounded-full border border-border bg-muted px-2 py-1 text-muted-foreground"},Js={class:"mt-3 whitespace-pre-line text-sm"},Ks={key:0,class:"mt-4 pt-3 border-t border-border flex items-center gap-2 text-xs text-muted-foreground"},Qs=["src","alt"],an=X({__name:"Show",props:{game:{},category:{},product:{},reviews:{},seo:{}},setup(i){const d=i,{selectionByGroup:t,qtyGroup:g,buildAddToCartPayload:N}=Pt(d.product),{unitCents:x,totalCents:w}=Vt(d.product,t),{loadSummary:_,setSummary:h}=Be(),u=k(()=>(d.product.option_groups??[]).filter(a=>a.type==="selector"));function f(a,n){return u.value.find(r=>r.code===a)??u.value.find(r=>n.test((r.title||"").toLowerCase()))}function o(a){return u.value.find(n=>n.code===a)}const l=k(()=>o("unique_d4_stats")),e=k(()=>l.value?o("ga"):void 0),c=k({get:()=>{if(!e.value)return null;const a=t.value[e.value.id];return Array.isArray(a)?a.length?Number(a[0]):null:typeof a=="number"&&Number.isFinite(a)?a:null},set:a=>{e.value&&(t.value[e.value.id]=a)}}),A=k({get:()=>{const a=l.value;if(!a)return[];const n=t.value[a.id];return Array.isArray(n)?n:typeof n=="number"&&Number.isFinite(n)?[n]:[]},set:a=>{l.value&&(t.value[l.value.id]=Array.isArray(a)?a:[])}}),S=k(()=>f("class",/class|класс/)),E=k(()=>f("slot",/slot|слот|предмет/)),H=k(()=>f("affix",/affix|аффикс|характеристик/)),J=k(()=>l.value?void 0:f("ga",/\b(ga|greater)\b/));function V(a,n=0,r=3){const M=Number(a);return Math.min(r,Math.max(n,Number.isFinite(M)?M:0))}const L=k(()=>{const a=J.value;if(!a)return 0;const n=t.value[a.id],r=Array.isArray(n)?n[0]:n,M=a.values?.find(I=>I.id===r),P=Number(M?.meta?.ga_count);if(Number.isFinite(P))return V(P);const q=String(M?.title??"").match(/(\d)/);return V(q?Number(q[1]):0)}),B=k({get:()=>{const a=S.value;if(!a)return null;const n=t.value[a.id];return Array.isArray(n)?n.length?Number(n[0]):null:typeof n=="number"&&Number.isFinite(n)?n:null},set:a=>{const n=S.value;n&&(t.value[n.id]=a==null?null:Number(a))}}),ee=k({get:()=>{const a=E.value;if(!a)return null;const n=t.value[a.id];return Array.isArray(n)?n.length?Number(n[0]):null:typeof n=="number"&&Number.isFinite(n)?n:null},set:a=>{const n=E.value;n&&(t.value[n.id]=a==null?null:Number(a))}}),se=k({get:()=>{const a=H.value;if(!a)return[];const n=t.value[a.id];return Array.isArray(n)?n:typeof n=="number"&&Number.isFinite(n)?[n]:[]},set:a=>{const n=H.value;if(!n)return;const r=Array.isArray(a)?a:a!=null?[Number(a)]:[];t.value[n.id]=r}}),y=k({get:()=>t.value._affix_ga_ids??[],set:a=>{t.value._affix_ga_ids=Array.isArray(a)?Array.from(new Set(a.map(Number))).slice(0,3):[]}});Pe(()=>{const a=S.value;if(a){const q=t.value[a.id];Array.isArray(q)&&(t.value[a.id]=q.length?Number(q[0]):null)}const n=E.value;if(n){const q=t.value[n.id];Array.isArray(q)&&(t.value[n.id]=q.length?Number(q[0]):null)}const r=J.value;if(r){const q=t.value[r.id];if((Array.isArray(q)?q[0]:q)==null){const F=r.values?.find(T=>Number(T?.meta?.ga_count)===0)??r.values?.find(T=>/(^|\s)non[-\s]?ga($|\s)|\b0\s*ga\b/i.test(String(T.title??"")))??r.values?.[0];t.value[r.id]=F?.id??null}}const M=e.value;if(M){const q=t.value[M.id];if(Array.isArray(q)&&(t.value[M.id]=q.length?Number(q[0]):null),t.value[M.id]==null){const F=M.values?.find(T=>Number(T?.meta?.ga_count)===0)??M.values?.find(T=>/(^|\s)non[-\s]?ga($|\s)|\b0\s*ga\b/i.test(String(T.title??"")))??M.values?.[0];t.value[M.id]=F?.id??null}}const P=H.value;if(P){const q=t.value[P.id];Array.isArray(q)||(t.value[P.id]=typeof q=="number"&&Number.isFinite(q)?[q]:[])}});const p=k(()=>new Set([S.value?.id,E.value?.id,H.value?.id].filter(Boolean))),b=k(()=>new Set([e.value?.id,l.value?.id].filter(Boolean))),W=k(()=>{const a=new Set;for(const n of p.value)a.add(n);for(const n of b.value)a.add(n);return a}),ne=k(()=>(d.product.option_groups??[]).filter(a=>a.type!=="unique_d4"&&!W.value.has(a.id))),$e=k(()=>{const a=(d.product.option_groups??[]).filter(r=>r.type==="bundle");let n=0;for(const r of a){const M=t.value[r.id];if(!(!Array.isArray(M)||!M.length))for(const P of M){const q=r.items?.find(I=>I.product_id===P.product_id);q&&(n+=(q.price_cents||0)*(Number(P.qty)||0))}}return n}),te=j(!1),K=j([]),ie=j(!1),me=k(()=>{const a=new Set([e.value?.id,l.value?.id].filter(Boolean));return(d.product.option_groups??[]).filter(n=>{if(n.type!=="selector"||!n.is_required||a.has(n.id))return!1;const r=t.value[n.id];return n.selection_mode==="single"?typeof r!="number":!Array.isArray(r)||r.length===0}).map(n=>n.id)}),pe=j(!0),fe=k(()=>new Set(me.value)),we=k(()=>{if(me.value.length)return!1;if(J.value){const a=L.value,n=y.value?.length??0;if(a!==n||!pe.value)return!1}return!0});function ve(a){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format((a||0)/100)}const Ae=k(()=>(g?x.value:w.value)+$e.value);async function Se(){if(K.value=[],ie.value=!0,!we.value){if(J.value){const a=L.value,n=y.value?.length??0;a!==n&&K.value.push(`Выберите ровно ${a} аффикс(а/ов) с отметкой GA.`)}K.value.push("Заполните обязательные опции перед добавлением в корзину.");return}if(!te.value){te.value=!0;try{const a=(d.product.option_groups??[]).filter(I=>I.type==="bundle"),n=[];let r=null;for(const I of a){const F=t.value[I.id];if(Array.isArray(F))for(const T of F)T?.product_id&&T?.qty>0&&n.push({product_id:Number(T.product_id),qty:Number(T.qty)})}if(n.length){for(const I of n){const{data:F}=await _e.post("/cart/add",{product_id:I.product_id,qty:I.qty});F?.summary&&(r=F.summary)}r?h(r,{refreshWindow:!0}):await _({force:!0});return}const M=N();if(e.value&&l.value){const I=e.value.id;let F=t.value[I];const T=F==null?null:Number(Array.isArray(F)?F[0]:F);if(!T){K.value=["Select GA level first."],te.value=!1;return}const Y=new Set(Array.isArray(M.option_value_ids)?M.option_value_ids:[]);Y.add(T);const Ce=Array.isArray(A.value)?A.value.map(Number):[];for(const Ie of Ce)Y.add(Ie);M.option_value_ids=Array.from(Y),delete M.affix_ga_ids}!!l.value?delete M.affix_ga_ids:M.affix_ga_ids=y.value??[];const{data:q}=await _e.post("/cart/add",M);q?.summary?h(q.summary,{refreshWindow:!0}):await _({force:!0})}catch(a){K.value.push(a?.response?.data?.message||"Failed to add to cart")}finally{te.value=!1}}}function Me(a){if(!a)return"";const n=a.replace(" ","T"),r=new Date(n);return Number.isNaN(r.getTime())?a:new Intl.DateTimeFormat("en-GB",{day:"2-digit",month:"short",year:"numeric"}).format(r)}function Ge(a){if(!a)return"";const n=a.replace(" ","T"),r=new Date(n);if(Number.isNaN(r.getTime()))return"";let P=new Date().getTime()-r.getTime();P<0&&(P=0);const q=1440*60*1e3,I=Math.floor(P/q);if(I<=0)return"Today";if(I===1)return"1 day ago";if(I<7)return`${I} days ago`;const F=Math.floor(I/7);if(F===1)return"1 week ago";if(F<5)return`${F} weeks ago`;const T=Math.floor(I/30);if(T<=11)return T===1?"1 month ago":`${T} months ago`;const Y=Math.floor(I/365);return Y<=1?"1+ years ago":`${Y}+ years ago`}function qe(a){const n=Math.max(0,Math.min(5,Math.round(Number(a)||0)));return Array.from({length:5},(r,M)=>M<n)}return(a,n)=>(m(),v(C,null,[ce(Oe,{seo:d.seo},null,8,["seo"]),ce(Ve,null,{default:Re(()=>[s("section",ks,[ce(je,{game:a.game,category:a.category,product:a.product},null,8,["game","category","product"]),K.value.length?(m(),v("div",$s,[s("ul",ws,[(m(!0),v(C,null,R(K.value,(r,M)=>(m(),v("li",{key:M},$(r),1))),128))])])):U("",!0),s("div",As,[s("div",null,[a.product.image_url?(m(),v("img",{key:0,src:a.product.image_url,class:"w-full rounded-xl border border-border"},null,8,Ss)):(m(),v("div",Ms," No image "))]),s("div",null,[s("h1",Gs,$(a.product.name),1),s("div",qs,[D($(G(g)?"Unit":"Price")+": ",1),s("span",null,$(ve(Ae.value)),1),G(g)?(m(),v(C,{key:0},[n[7]||(n[7]=D(" → Total: ",-1)),s("span",Cs,$(ve(G(w))),1)],64)):U("",!0)]),e.value&&l.value?(m(),ae(Ns,{key:0,"ga-group":e.value,"stats-group":l.value,"ga-selected":c.value,"onUpdate:gaSelected":n[0]||(n[0]=r=>c.value=r),"stats-selected":A.value,"onUpdate:statsSelected":n[1]||(n[1]=r=>A.value=r)},null,8,["ga-group","stats-group","ga-selected","stats-selected"])):U("",!0),S.value&&E.value&&H.value?(m(),ae(_s,{key:1,"class-group":S.value,"slot-group":E.value,"affix-group":H.value,currency:"USD","ga-limit":L.value,"class-id":B.value,"onUpdate:classId":n[2]||(n[2]=r=>B.value=r),"slot-id":ee.value,"onUpdate:slotId":n[3]||(n[3]=r=>ee.value=r),"affix-ids":se.value,"onUpdate:affixIds":n[4]||(n[4]=r=>se.value=r),"affix-ga-ids":y.value,"onUpdate:affixGaIds":n[5]||(n[5]=r=>y.value=r),onGaValid:n[6]||(n[6]=r=>pe.value=r)},null,8,["class-group","slot-group","affix-group","ga-limit","class-id","slot-id","affix-ids","affix-ga-ids"])):U("",!0),ne.value.length?(m(),v("div",Is,[(m(!0),v(C,null,R(ne.value,r=>(m(),v(C,null,[G(ye)(r.type,r)?(m(),v("div",{key:r.id,class:oe(["border rounded-lg p-3",ie.value&&fe.value.has(r.id)?"border-red-400":"border-border"])},[(m(),ae(Ee(G(ye)(r.type,r)),{group:r,selected:G(t)[r.id],"onUpdate:selected":M=>G(t)[r.id]=M},null,40,["group","selected","onUpdate:selected"])),ie.value&&fe.value.has(r.id)?(m(),v("p",Us," Это поле обязательно для выбора ")):U("",!0)],2)):U("",!0)],64))),256))])):U("",!0),s("button",{class:"mt-5 px-4 py-2 rounded-lg bg-primary text-primary-foreground",onClick:Le(Se,["prevent"])},$(te.value?"Adding…":"Add to cart"),1),s("div",Ts,[s("div",Fs,[n[8]||(n[8]=s("h2",{class:"text-2xl font-semibold"},"Latest reviews",-1)),s("a",{href:a.route("reviews.public",{product_id:a.product.id}),class:"text-sm underline text-primary hover:opacity-80"}," See all reviews ",8,Ds)]),d.reviews?.length?(m(),v("div",Rs,[(m(!0),v(C,null,R(d.reviews,r=>(m(),v("div",{key:r.id,class:"border border-border rounded-xl p-4"},[s("div",Es,[s("div",Ls,[!r.is_anonymous&&r.avatar_url?(m(),v("img",{key:0,src:r.avatar_url,class:"w-10 h-10 rounded-full object-cover",alt:r.display_name??"User"},null,8,Vs)):(m(),v("div",Bs)),s("div",null,[s("div",js,$(r.is_anonymous?"Anonymous":r.display_name??"Verified customer"),1),s("div",Os,[s("div",zs,[(m(!0),v(C,null,R(qe(r.rating),(M,P)=>(m(),ae(G(ze),{key:P,class:oe(["h-4 w-4",M?"text-primary fill-primary":"text-muted-foreground/40"])},null,8,["class"]))),128))]),r.published_at?(m(),v("span",Ws,"· "+$(Me(r.published_at)),1)):U("",!0)])])]),r.published_at?(m(),v("div",Hs,$(Ge(r.published_at)),1)):U("",!0)]),s("div",Js,$(r.body),1),r.game?.name?(m(),v("div",Ks,[r.game.image_url?(m(),v("img",{key:0,src:r.game.image_url,class:"w-5 h-5 rounded object-cover",alt:r.game.name??""},null,8,Qs)):U("",!0),s("span",null,$(r.game.name),1)])):U("",!0)]))),128))])):(m(),v("div",Ps," No reviews yet. Be the first to leave one after delivery. "))])])])])]),_:1})],64))}});export{an as default};
